<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venba Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #4CAF50;
        }
        #venba-input {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        #result, #analysis {
            margin-top: 20px;
            font-weight: bold;
        }
        #analysis p {
            margin: 5px 0;
        }
    </style>
</head>
<body>

<h1>Venba Analyzer</h1>
<p>Enter a Tamil text to check if it follows Venba rules.</p>
<input type="text" id="venba-input" placeholder="Enter Tamil text">
<button onclick="analyzeVenba()">Analyze</button>

<div id="result"></div>
<div id="analysis"></div>

<script>
    const tamilLetters = [
        "ஃ", "அ", "ஆ", "இ", "ஈ", "உ", "ஊ", "எ", "ஏ", "ஒ", "ஓ",
        "க", "கா", "கி", "கீ", "கு", "கூ", "கெ", "கே", "கொ", "கோ",
        "ங", "ஙா", "ஙி", "ஙீ", "ஙு", "ஙூ", "ஙெ", "ஙே", "ஙொ", "ஙோ",
        "ச", "சா", "சி", "சீ", "சு", "சூ", "செ", "சே", "சொ", "சோ",
        "ஞ", "ஞா", "ஞி", "ஞீ", "ஞு", "ஞூ", "ஞெ", "ஞே", "ஞொ", "ஞோ",
        "ட", "டா", "டி", "டீ", "டு", "டூ", "டெ", "டே", "டொ", "டோ",
        "ண", "ணா", "ணி", "ணீ", "ணு", "ணூ", "ணெ", "ணே", "ணொ", "ணோ",
        "த", "தா", "தி", "தீ", "து", "தூ", "தெ", "தே", "தொ", "தோ",
        "ந", "நா", "நி", "நீ", "நு", "நூ", "நெ", "நே", "நொ", "நோ",
        "ப", "பா", "பி", "பீ", "பு", "பூ", "பெ", "பே", "பொ", "போ",
        "ம", "மா", "மி", "மீ", "மு", "மூ", "மெ", "மே", "மொ", "மோ",
        "ய", "யா", "யி", "யீ", "யு", "யூ", "யெ", "யே", "யொ", "யோ",
        "ர", "ரா", "ரி", "ரீ", "ரு", "ரூ", "ரெ", "ரே", "ரொ", "ரோ",
        "ல", "லா", "லி", "லீ", "லு", "லூ", "லெ", "லே", "லொ", "லோ",
        "வ", "வா", "வி", "வீ", "வு", "வூ", "வெ", "வே", "வொ", "வோ",
        "ழ", "ழா", "ழி", "ழீ", "ழு", "ழூ", "ழெ", "ழே", "ழொ", "ழோ",
        "ள", "ளா", "ளி", "ளீ", "ளு", "ளூ", "ளெ", "ளே", "ளொ", "ளோ",
        "ற", "றா", "றி", "றீ", "று", "றூ", "றெ", "றே", "றொ", "றோ",
        "ன", "னா", "னி", "னீ", "னு", "னூ", "னெ", "னே", "னொ", "னோ",
        "ஐ", "கை", "ஙை", "சை", "ஞை", "டை", "ணை", "தை", "நை",
        "பை", "மை", "யை", "ரை", "லை", "வை", "ழை", "ளை", "றை", "னை",
        "ஔ", "கௌ", "ஙௌ", "சௌ", "ஞௌ", "டௌ", "ணௌ", "தௌ", "நௌ", "பௌ",
        "மௌ", "யௌ", "ரௌ", "லௌ", "வௌ", "ழௌ", "ளௌ", "றௌ", "னௌ",
        "க்", "ங்", "ச்", "ஞ்", "ட்", "ண்", "த்", "ந்", "ப்", "ம்",
        "ய்", "ர்", "ல்", "வ்", "ழ்", "ள்", "ற்", "ன்"
    ];

    const mathiraiMap = new Map();
    tamilLetters.forEach((letter, index) => {
        if (index % 2 === 0) mathiraiMap.set(letter, 2.0);
        else mathiraiMap.set(letter, 1.0);
    });

    // Define specific values based on rules
    for (let i = tamilLetters.indexOf("ஐ"); i < tamilLetters.indexOf("க்"); i++) mathiraiMap.set(tamilLetters[i], 2.0);
    for (let i = tamilLetters.indexOf("க்"); i <= tamilLetters.indexOf("ன்"); i++) mathiraiMap.set(tamilLetters[i], 0.5);

    const splitToSyllables = (input) => {
        const syllables = [];
        for (let i = 0; i < input.length; i++) {
            const currentChar = input[i];
            if (i < input.length - 1 && isTamilCompound(input[i + 1])) {
                syllables.push(input.slice(i, i + 2));
                i++;
            } else syllables.push(currentChar);
        }
        return syllables;
    };

    const isTamilCompound = (ch) => {
        return ch >= '\u0BBE' && ch <= '\u0BCD';
    };

    const getMathiraiValues = (input) => {
        const syllables = splitToSyllables(input);
        const result = [];
        syllables.forEach(syllable => {
            const mathirai = mathiraiMap.get(syllable) ?? -1.0;
            result.push(mathirai);
        });
        return result;
    };

    const applyNiraiNerRules = (values) => {
        const analysis = [];
        let nerniraiStr = "";
        for (let i = 0; i < values.length;) {
            if (i + 2 < values.length && values[i] === 1.0 && values[i + 1] === 1.0 && values[i + 2] === 0.5) {
                analysis.push("நிரை");
                i += 3;
                nerniraiStr += '1';
            } else if (i + 1 < values.length && values[i] === 1.0 && values[i + 1] === 0.5) {
                analysis.push("நேர்");
                i += 2;
                nerniraiStr += '0';
            } else {
                i++;
            }
        }
        return { analysis, nerniraiStr };
    };

    const isVenba = (nerniraiList) => {
        const size = nerniraiList.length;
        if (![7, 15, 31, 47].includes(size)) return false;
        const lastSir = nerniraiList[size - 1];
        if (["01", "11"].includes(lastSir)) return false;

        for (let i = 0; i < size - 1; i++) {
            const current = nerniraiList[i];
            const next = nerniraiList[i + 1];
            if (current.length === 3 && (current[2] !== '0' || next[0] !== '0')) return false;
            if (current.length === 2) {
                const expectedStart = current[1] === '0' ? '1' : '0';
                if (next[0] !== expectedStart) return false;
            }
        }
        return true;
    };

    const printVenbaWords = (nerniraiList) => {
        nerniraiList.forEach(current => {
            switch (current) {
                case "00": console.log("தேமா "); break;
                case "10": console.log("புளிமா "); break;
                case "01": console.log("கூவிளம் "); break;
                case "11": console.log("கருவிளம் "); break;
                case "000": console.log("தேமாங்காய் "); break;
                case "100": console.log("புளிமாங்காய் "); break;
                case "010": console.log("கூவிளங்காய் "); break;
                case "110": console.log("கருவிளங்காய் "); break;
            }
        });
        const lastSir = nerniraiList[nerniraiList.length - 1];
        switch (lastSir) {
            case "0": console.log("நாள்"); break;
            case "1": console.log("மலர்"); break;
            case "00": console.log("காசு"); break;
            case "10": console.log("பிறப்பு"); break;
        }
    };

    const analyzeVenba = () => {
        const sentence = document.getElementById("venba-input").value;
        const mathiraiValues = getMathiraiValues(sentence);
        
        const niraiNerAnalysis = [];
        let tempValues = [];
        mathiraiValues.forEach(value => {
            if (value === -1.0) {
                const { analysis, nerniraiStr } = applyNiraiNerRules(tempValues);
                niraiNerAnalysis.push(...analysis, " ");
                tempValues = [];
            } else tempValues.push(value);
        });
        if (tempValues.length > 0) {
            const { analysis, nerniraiStr } = applyNiraiNerRules(tempValues);
            niraiNerAnalysis.push(...analysis);
        }
        const nerniraiList = niraiNerAnalysis.join(" ");
        
        const resultDiv = document.getElementById("result");
        const analysisDiv = document.getElementById("analysis");
        
        resultDiv.textContent = isVenba(nerniraiList) ? "It's a Venba!" : "It's not a Venba.";
        analysisDiv.innerHTML = niraiNerAnalysis.map(a => `<p>${a}</p>`).join("");
    };
</script>

</body>
</html>
