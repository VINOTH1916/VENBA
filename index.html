<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venba Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #333;
        }
        input, button {
            padding: 10px;
            margin-top: 10px;
            font-size: 16px;
        }
        .output {
            margin-top: 20px;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Venba Checker</h1>
    <p>Enter a Tamil Venba text below to check if it's a valid Venba:</p>
    
    <input type="text" id="inputText" placeholder="Enter Venba text here">
    <button onclick="checkVenba()">Check Venba</button>

    <div class="output" id="output"></div>

    <script>
        const tamilLetters = [
    "ஃ", "அ", "ஆ", "இ", "ஈ", "உ", "ஊ", "எ", "ஏ", "ஒ", "ஓ",
    "க", "கா", "கி", "கீ", "கு", "கூ", "கெ", "கே", "கொ", "கோ",
    "ங", "ஙா", "ஙி", "ஙீ", "ஙு", "ஙூ", "ஙெ", "ஙே", "ஙொ", "ஙோ",
    "ச", "சா", "சி", "சீ", "சு", "சூ", "செ", "சே", "சொ", "சோ",
    "ஞ", "ஞா", "ஞி", "ஞீ", "ஞு", "ஞூ", "ஞெ", "ஞே", "ஞொ", "ஞோ",
    "ட", "டா", "டி", "டீ", "டு", "டூ", "டெ", "டே", "டொ", "டோ",
    "ண", "ணா", "ணி", "ணீ", "ணு", "ணூ", "ணெ", "ணே", "ணொ", "ணோ",
    "த", "தா", "தி", "தீ", "து", "தூ", "தெ", "தே", "தொ", "தோ",
    "ந", "நா", "நி", "நீ", "நு", "நூ", "நெ", "நே", "நொ", "நோ",
    "ப", "பா", "பி", "பீ", "பு", "பூ", "பெ", "பே", "பொ", "போ",
    "ம", "மா", "மி", "மீ", "மு", "மூ", "மெ", "மே", "மொ", "மோ",
    "ய", "யா", "யி", "யீ", "யு", "யூ", "யெ", "யே", "யொ", "யோ",
    "ர", "ரா", "ரி", "ரீ", "ரு", "ரூ", "ரெ", "ரே", "ரொ", "ரோ",
    "ல", "லா", "லி", "லீ", "லு", "லூ", "லெ", "லே", "லொ", "லோ",
    "வ", "வா", "வி", "வீ", "வு", "வூ", "வெ", "வே", "வொ", "வோ",
    "ழ", "ழா", "ழி", "ழீ", "ழு", "ழூ", "ழெ", "ழே", "ழொ", "ழோ",
    "ள", "ளா", "ளி", "ளீ", "ளு", "ளூ", "ளெ", "ளே", "ளொ", "ளோ",
    "ற", "றா", "றி", "றீ", "று", "றூ", "றெ", "றே", "றொ", "றோ",
    "ன", "னா", "னி", "னீ", "னு", "னூ", "னெ", "னே", "னொ", "னோ",
    "ஐ", "கை", "ஙை", "சை", "ஞை", "டை", "ணை", "தை", "நை",
    "பை", "மை", "யை", "ரை", "லை", "வை", "ழை", "ளை", "றை", "னை",
    "ஔ", "கௌ", "ஙௌ", "சௌ", "ஞௌ", "டௌ", "ணௌ", "தௌ", "நௌ", "பௌ",
    "மௌ", "யௌ", "ரௌ", "லௌ", "வௌ", "ழௌ", "ளௌ", "றௌ", "னௌ",
    "க்", "ங்", "ச்", "ஞ்", "ட்", "ண்", "த்", "ந்", "ப்", "ம்",
    "ய்", "ர்", "ல்", "வ்", "ழ்", "ள்", "ற்", "ன்"
];

const mathiraiMap = new Map();
const nernirai = [];
let j = 0;

function initializeMathiraiMap() {
    let i = 1;
    while (tamilLetters[i] !== "ஐ") {
        if (i % 2 === 0) {
            mathiraiMap.set(tamilLetters[i], 2.0);
        } else {
            mathiraiMap.set(tamilLetters[i], 1.0);
        }
        i++;
    }
    while (tamilLetters[i] !== "க்") {
        mathiraiMap.set(tamilLetters[i], 2.0);
        i++;
    }
    while (tamilLetters[i] !== "ன்") {
        mathiraiMap.set(tamilLetters[i], 0.5);
        i++;
    }
    mathiraiMap.set("ன்", 0.5);
}

function splitToSyllables(input) {
    const syllables = [];
    let i = 0;
    const length = input.length;
    while (i < length) {
        const currentChar = input.charAt(i);
        if (i < length - 1 && isTamilCompound(input.charAt(i + 1))) {
            syllables.push(input.substring(i, i + 2));
            i++;
        } else {
            syllables.push(currentChar);
        }
        i++;
    }
    return syllables;
}

function isTamilCompound(ch) {
    return ch >= '\u0BBE' && ch <= '\u0BCD';
}

function getMathiraiValues(input) {
    const syllables = splitToSyllables(input);
    const result = [];
    syllables.forEach(syllable => {
        let mathirai = mathiraiMap.get(syllable);
        if (syllable === " ") {
            mathirai = -1.0;
        }
        if (mathirai !== undefined) {
            result.push(mathirai);
        } else {
            console.log("Unknown syllable: " + syllable);
        }
    });
    return result;
}

function applyNiraiNerRules(values, analysis) {
    let i = 0;
    nernirai[j] = "";
    while (i < values.length) {
        if (i + 2 < values.length && values[i] === 1.0 && values[i + 1] === 1.0 && values[i + 2] === 0.5) {
            analysis.push("நிரை");
            i += 3;
            nernirai[j] += '1';
        } else if (i + 2 < values.length && values[i] === 1.0 && values[i + 1] === 2.0 && values[i + 2] === 0.5) {
            analysis.push("நிரை");
            i += 3;
            nernirai[j] += '1';
        } else if (i + 1 < values.length && values[i] === 1.0 && values[i + 1] === 0.5) {
            analysis.push("நேர்");
            i += 2;
            nernirai[j] += '0';
        } else if (i + 1 < values.length && values[i] === 2.0 && values[i + 1] === 0.5) {
            analysis.push("நேர்");
            i += 2;
            nernirai[j] += '0';
        } else if (i + 1 < values.length && values[i] === 1.0 && values[i + 1] === 1.0) {
            analysis.push("நிரை");
            i += 2;
            nernirai[j] += '1';
        } else if (i + 1 < values.length && values[i] === 1.0 && values[i + 1] === 2.0) {
            analysis.push("நிரை");
            i += 2;
            nernirai[j] += '1';
        } else if (i < values.length && values[i] === 2.0) {
            analysis.push("நேர்");
            i++;
            nernirai[j] += '0';
        } else if (i < values.length && values[i] === 1.0) {
            analysis.push("நேர்");
            i++;
            nernirai[j] += '0';
        } else {
            i++;
        }
    }
    j++;
}

function isVenba(nerniraiList) {
    const size = nerniraiList.length;
    if (!(size === 7 || size === 15 || size === 31 || size === 47)) {
        return false;
    }
    const lastSir = nerniraiList[size - 1];
    const length = lastSir.length;
    if (!(length === 1 || length === 2)) {
        return false;
    }
    if (lastSir === "01" || lastSir === "11") {
        return false;
    }
    for (let i = 0; i < nerniraiList.length - 1; i++) {
        const current = nerniraiList[i];
        const next = nerniraiList[i + 1];
        if (current.length === 3) {
            if (current.charAt(2) !== '0' || next.charAt(0) !== '0') {
                return false;
            }
        } else if (current.length === 2) {
            const lastChar = current.charAt(1);
            const expectedStartChar = (lastChar === '0') ? '1' : '0';
            if (next.charAt(0) !== expectedStartChar) {
                return false;
            }
        }
    }
    return true;
}

function printVenbaWords(nerniraiList) {
    nerniraiList.forEach(current => {
        switch (current) {
            case "00":
                console.log("தேமா ");
                break;
            case "10":
                console.log("புளிமா ");
                break;
            case "01":
                console.log("கூவிளம் ");
                break;
            case "11":
                console.log("கருவிளம் ");
                break;
            case "000":
                console.log("தேமாங்காய் ");
                break;
            case "100":
                console.log("புளிமாங்காய் ");
                break;
            case "010":
                console.log("கூவிளங்காய் ");
                break;
            case "110":
                console.log("கருவிளங்காய் ");
                break;
        }
    });

    const lastSir = nerniraiList[nerniraiList.length - 1];
    switch (lastSir) {
        case "0":
            console.log("நாள்");
            break;
        case "1":
            console.log("மலர்");
            break;
        case "00":
            console.log("காசு");
            break;
        case "10":
            console.log("பிறப்பு");
            break;
    }
}

// Main execution
function checkVenba() {
            let inputText = document.getElementById('inputText').value;
            let mathiraiValues = getMathiraiValues(inputText);

            let { analysis, nernirai } = applyNiraiNerRules(mathiraiValues);
            let nerniraiList = [nernirai];

            let outputDiv = document.getElementById('output');
            outputDiv.innerHTML = `Mathirai values: ${mathiraiValues}<br>`;

            outputDiv.innerHTML += `Nirai Ner Analysis: ${analysis.join(', ')}<br>`;
            outputDiv.innerHTML += `Nernirai binary segments: ${nerniraiList.join(', ')}<br>`;

            if (isVenba(nerniraiList)) {
                outputDiv.innerHTML += "This is a Venba.";
            } else {
                outputDiv.innerHTML += "This is not a Venba.";
            }
        }

    </script>
</body>
</html>
